<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Jasmine's LifeOS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
        }
        
        .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 300ms; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        /* Animations */
        @keyframes checkmark {
            0% { stroke-dashoffset: 24; }
            100% { stroke-dashoffset: 0; }
        }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes slideUpDrawer {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .animate-checkmark { stroke-dasharray: 24; stroke-dashoffset: 24; animation: checkmark 0.4s ease-out forwards; }
        .animate-pop { animation: pop 0.3s ease-out; }
        .animate-toast { animation: slideUp 0.3s ease-out forwards; }
        .animate-drawer { animation: slideUpDrawer 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Confetti */
        .confetti-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; overflow: hidden; }
        .confetti { position: absolute; width: 10px; height: 10px; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 transition-colors duration-300 dark:bg-slate-950 dark:text-slate-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- Utilities ---
        const vibrate = () => { if (navigator.vibrate) navigator.vibrate(10); };
        
        const formatTime12Hour = (time24) => {
            if (!time24) return '';
            if (time24.includes('AM') || time24.includes('PM') || time24 === 'TBD') return time24;
            const [hours, minutes] = time24.split(':');
            const h = parseInt(hours, 10);
            const suffix = h >= 12 ? 'PM' : 'AM';
            const h12 = h % 12 || 12;
            return `${h12}:${minutes} ${suffix}`;
        };

        const triggerConfetti = () => {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#00ffff', '#ff00ff'];
            const container = document.createElement('div');
            container.className = 'confetti-container';
            document.body.appendChild(container);
            for (let i = 0; i < 50; i++) {
                const el = document.createElement('div');
                el.className = 'confetti';
                el.style.left = Math.random() * 100 + 'vw';
                el.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                el.style.animationDuration = (Math.random() * 2 + 1) + 's';
                el.style.opacity = Math.random();
                container.appendChild(el);
            }
            setTimeout(() => container.remove(), 3000);
        };

        // --- Icons ---
        const IconBase = ({ path, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>
        );

        const Icons = {
            Activity: (p) => <IconBase {...p} path={<polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />} />,
            CheckCircle: (p) => <IconBase {...p} path={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" className="animate-checkmark" /></>} />,
            Check: (p) => <IconBase {...p} path={<polyline points="20 6 9 17 4 12" />} />,
            Utensils: (p) => <IconBase {...p} path={<path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3z" />} />,
            Calendar: (p) => <IconBase {...p} path={<><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></>} />,
            Plus: (p) => <IconBase {...p} path={<><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></>} />,
            Brain: (p) => <IconBase {...p} path={<path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z" />} />,
            Trash2: (p) => <IconBase {...p} path={<><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /></>} />,
            X: (p) => <IconBase {...p} path={<><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></>} />,
            ShoppingBag: (p) => <IconBase {...p} path={<><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" /><line x1="3" y1="6" x2="21" y2="6" /><path d="M16 10a4 4 0 0 1-8 0" /></>} />,
            Settings: (p) => <IconBase {...p} path={<><circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" /></>} />,
            BookOpen: (p) => <IconBase {...p} path={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></>} />,
            Scale: (p) => <IconBase {...p} path={<><rect x="4" y="16" width="16" height="6" rx="2" ry="2" /><path d="M16 16v-4a4 4 0 0 0-8 0v4" /><path d="M12 16v-4" /></>} />,
            TrendingUp: (p) => <IconBase {...p} path={<><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></>} />,
            Run: (p) => <IconBase {...p} path={<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />} /> // Simplified user
        };

        // --- Shared Components ---
        const Card = ({ children, className = "", onClick, style }) => (
            <div onClick={onClick} style={style} className={`bg-white dark:bg-slate-900 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-800 p-5 transition active:scale-[0.98] ${onClick ? 'cursor-pointer' : ''} ${className}`}>
                {children}
            </div>
        );

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black/50 z-50 flex items-end md:items-center justify-center p-4 backdrop-blur-sm overflow-hidden" onClick={onClose}>
                    <div className="bg-white dark:bg-slate-900 w-full md:max-w-md max-h-[85vh] flex flex-col animate-drawer md:animate-toast rounded-t-3xl md:rounded-3xl shadow-2xl" onClick={e => e.stopPropagation()}>
                        <div className="p-5 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center flex-shrink-0">
                            <h3 className="font-bold text-lg dark:text-white">{title}</h3>
                            <button onClick={onClose} className="p-1"><Icons.X className="text-slate-400" /></button>
                        </div>
                        <div className="p-5 overflow-y-auto no-scrollbar">{children}</div>
                    </div>
                </div>
            );
        };

        const EmptyState = ({ emoji, message, buttonText, onButtonClick }) => (
            <div className="flex flex-col items-center justify-center p-10 border-2 border-dashed border-slate-200 dark:border-slate-800 rounded-3xl text-center">
                <span className="text-4xl mb-4">{emoji}</span>
                <p className="text-slate-500 dark:text-slate-400 mb-6 max-w-xs font-medium">{message}</p>
                {buttonText && (
                    <button onClick={onButtonClick} className="bg-indigo-600 text-white px-5 py-2.5 rounded-full font-bold shadow-lg shadow-indigo-500/20 active:scale-95 transition">
                        {buttonText}
                    </button>
                )}
            </div>
        );

        // --- Main Application ---
        function App() {
            // -- State --
            const [activeTab, setActiveTab] = useState('dashboard');
            const [darkMode, setDarkMode] = useState(false);
            const [toasts, setToasts] = useState([]);
            const [isQuickAddOpen, setIsQuickAddOpen] = useState(false);
            const [quickAddType, setQuickAddType] = useState('task');
            
            // Popovers
            const [mealPopoverOpen, setMealPopoverOpen] = useState(false);
            const [readPopoverOpen, setReadPopoverOpen] = useState(false);

            // Data
            const [user, setUser] = useState({ name: 'Jasmine', points: 0, waterGoal: 8, readGoal: 20, currentBook: 'Atomic Habits', weight: 170, goalWeight: 162 });
            // Modified Fitness State for Athlete Persona
            const [fitness, setFitness] = useState({ 
                mileRun: false, 
                strength: false, 
                recovery: 0, 
                workouts: [] 
            });
            const [nutrition, setNutrition] = useState({ water: 0, meals: [] });
            const [mindfulness, setMindfulness] = useState({ devotional: false, readPages: 0 });
            const [tasks, setTasks] = useState([
                { id: 1, title: 'Clean golf clubs', energy: 'low', time: 20, complete: false, category: 'personal' }
            ]);
            const [groceries, setGroceries] = useState([{ id: 1, name: 'Oatmeal (Low Cholesterol)', category: 'Pantry', checked: false }]);
            const [events, setEvents] = useState([
                { id: 1, title: 'Morning Run', time: '07:30', date: new Date().toLocaleDateString(), category: 'fitness' }
            ]);
            
            // -- Persistence & Init --
            useEffect(() => {
                const saved = localStorage.getItem('lifeos-jasmine-v1');
                if (saved) {
                    const d = JSON.parse(saved);
                    // Reset daily habits if new day
                    if (d.lastActiveDate !== new Date().toLocaleDateString()) {
                        setFitness(prev => ({ ...prev, mileRun: false, strength: false, workouts: [] }));
                        setNutrition(prev => ({ ...prev, water: 0, meals: [] }));
                        setMindfulness(prev => ({ ...prev, devotional: false, readPages: 0 }));
                        setTasks(prev => prev.filter(t => !t.complete)); // Clear completed tasks
                    } else {
                        setFitness(d.fitness || fitness);
                        setNutrition(d.nutrition || nutrition);
                        setMindfulness(d.mindfulness || mindfulness);
                    }
                    setUser(d.user || user);
                    setTasks(d.tasks || tasks);
                    setGroceries(d.groceries || groceries);
                    setEvents(d.events || events);
                    setDarkMode(d.darkMode || false);
                }
            }, []);

            useEffect(() => {
                const data = { user, fitness, nutrition, mindfulness, tasks, groceries, events, darkMode, lastActiveDate: new Date().toLocaleDateString() };
                localStorage.setItem('lifeos-jasmine-v1', JSON.stringify(data));
                if (darkMode) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }, [user, fitness, nutrition, mindfulness, tasks, groceries, events, darkMode]);

            // -- Logic --
            const showToast = useCallback((message, type = 'success', points = 0) => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, points }]);
                setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 4000);
                vibrate();
                if (points > 0) setUser(prev => ({...prev, points: prev.points + points}));
            }, []);

            const calculateScore = () => {
                // Modified Scoring for Athlete Goals
                let score = 0;
                if (fitness.mileRun) score += 25; // High priority
                if (fitness.strength) score += 25; // High priority
                if (mindfulness.devotional) score += 10;
                if (mindfulness.readPages >= user.readGoal) score += 10;
                if (nutrition.water >= user.waterGoal) score += 10;
                if (nutrition.meals.length >= 3) score += 10;
                // Cap at 100
                return Math.min(100, score + (tasks.filter(t=>t.complete).length * 5));
            };

            const toggleMileRun = () => {
                if (fitness.mileRun) return;
                setFitness(prev => ({...prev, mileRun: true}));
                triggerConfetti();
                showToast("Mile Crushed! üèÉ‚Äç‚ôÄÔ∏è", "success", 25);
            };

            const toggleStrength = () => {
                if (fitness.strength) return;
                setFitness(prev => ({...prev, strength: true}));
                triggerConfetti();
                showToast("Strength Gains! üí™", "success", 25);
            };

            const logMeal = (type, healthyChoice = false) => {
                setNutrition(prev => ({...prev, meals: [...prev.meals, { time: new Date(), type }]}));
                showToast(healthyChoice ? "Smart Choice! ü•ó" : "Meal Logged üçΩÔ∏è", "success", 5);
                setMealPopoverOpen(false);
            };

            const completeTask = (id) => {
                setTasks(prev => prev.map(t => t.id === id ? { ...t, complete: true } : t));
                showToast("Task Done! ‚úì", "success", 10);
            };

            // -- Components --
            const ScoreRing = () => {
                const score = calculateScore();
                const radius = 60; const stroke = 8; const normalizedRadius = radius - stroke * 2;
                const circumference = normalizedRadius * 2 * Math.PI;
                const strokeDashoffset = circumference - (score / 100) * circumference;
                
                return (
                    <div className="flex flex-col items-center justify-center py-6">
                        <div className="relative w-48 h-48 flex items-center justify-center">
                            <svg height={radius * 2.5} width={radius * 2.5} className="rotate-[-90deg]">
                                <circle className="text-slate-200 dark:text-slate-800" stroke="currentColor" strokeWidth={stroke} r={normalizedRadius} cx={radius * 1.25} cy={radius * 1.25} fill="transparent" />
                                <circle className="text-indigo-500 transition-all duration-1000 ease-out" stroke="currentColor" fill="transparent" strokeWidth={stroke} strokeDasharray={circumference + ' ' + circumference} style={{ strokeDashoffset, strokeLinecap: 'round' }} r={normalizedRadius} cx={radius * 1.25} cy={radius * 1.25} />
                            </svg>
                            <div className="absolute flex flex-col items-center animate-pop">
                                <span className="text-6xl font-black text-indigo-600 tracking-tighter">{score}</span>
                                <span className="text-xs font-bold text-slate-400 uppercase tracking-widest mt-1">Daily Win</span>
                            </div>
                        </div>
                    </div>
                );
            };

            const SmartSuggestion = () => {
                // ADHD logic: Only show the ONE most important next thing
                if (!fitness.mileRun) return (
                    <Card onClick={toggleMileRun} className="bg-gradient-to-r from-orange-500 to-red-500 text-white border-none mb-6">
                        <div className="flex items-center gap-4">
                            <div className="text-4xl">üèÉ‚Äç‚ôÄÔ∏è</div>
                            <div><div className="font-bold text-lg">Run Your Mile</div><div className="text-white/80 text-xs uppercase font-bold tracking-wide">Priority #1 ‚Ä¢ Get it done</div></div>
                        </div>
                    </Card>
                );
                if (!fitness.strength) return (
                    <Card onClick={toggleStrength} className="bg-gradient-to-r from-blue-500 to-indigo-500 text-white border-none mb-6">
                         <div className="flex items-center gap-4">
                            <div className="text-4xl">üí™</div>
                            <div><div className="font-bold text-lg">Strength Training</div><div className="text-white/80 text-xs uppercase font-bold tracking-wide">Lean out goal</div></div>
                        </div>
                    </Card>
                );
                if (!mindfulness.devotional) return (
                    <Card onClick={() => { setMindfulness(p => ({...p, devotional: true})); showToast("Spirit Fed üôè", "success", 10); triggerConfetti(); }} className="bg-gradient-to-r from-purple-500 to-pink-500 text-white border-none mb-6">
                         <div className="flex items-center gap-4">
                            <div className="text-4xl">üìñ</div>
                            <div><div className="font-bold text-lg">Daily Devotional</div><div className="text-white/80 text-xs uppercase font-bold tracking-wide">Quiet time</div></div>
                        </div>
                    </Card>
                );
                return null;
            };

            const DailyGrid = () => (
                <div className="grid grid-cols-2 gap-3 mb-6">
                    <button onClick={toggleMileRun} className={`p-4 rounded-2xl border-2 flex flex-col items-center justify-center transition-all ${fitness.mileRun ? 'bg-orange-50 border-orange-500 text-orange-600' : 'bg-white dark:bg-slate-900 border-slate-100 dark:border-slate-800'}`}>
                        <span className="text-2xl mb-1">üèÉ‚Äç‚ôÄÔ∏è</span>
                        <span className="font-bold text-xs uppercase">1 Mile Run</span>
                        {fitness.mileRun && <Icons.Check size={16} className="mt-1" />}
                    </button>
                    <button onClick={toggleStrength} className={`p-4 rounded-2xl border-2 flex flex-col items-center justify-center transition-all ${fitness.strength ? 'bg-blue-50 border-blue-500 text-blue-600' : 'bg-white dark:bg-slate-900 border-slate-100 dark:border-slate-800'}`}>
                        <span className="text-2xl mb-1">üèãÔ∏è‚Äç‚ôÄÔ∏è</span>
                        <span className="font-bold text-xs uppercase">Lift</span>
                        {fitness.strength && <Icons.Check size={16} className="mt-1" />}
                    </button>
                     <button onClick={() => setMealPopoverOpen(true)} className={`p-4 rounded-2xl border-2 flex flex-col items-center justify-center transition-all ${nutrition.meals.length >= 3 ? 'bg-green-50 border-green-500 text-green-600' : 'bg-white dark:bg-slate-900 border-slate-100 dark:border-slate-800'}`}>
                        <span className="text-2xl mb-1">ü•ó</span>
                        <span className="font-bold text-xs uppercase">Log Food</span>
                        <span className="text-[10px] text-slate-400 mt-1">Watch Cholesterol</span>
                    </button>
                    <button onClick={() => setReadPopoverOpen(true)} className={`p-4 rounded-2xl border-2 flex flex-col items-center justify-center transition-all ${mindfulness.readPages >= user.readGoal ? 'bg-purple-50 border-purple-500 text-purple-600' : 'bg-white dark:bg-slate-900 border-slate-100 dark:border-slate-800'}`}>
                        <span className="text-2xl mb-1">üìö</span>
                        <span className="font-bold text-xs uppercase">Reading</span>
                        <span className="text-[10px] text-slate-400 mt-1">{mindfulness.readPages}/{user.readGoal} pgs</span>
                    </button>
                </div>
            );

            // -- Views --
            const Dashboard = () => (
                <div className="space-y-6 pb-24">
                    <SmartSuggestion />
                    <ScoreRing />
                    <h3 className="font-bold text-slate-400 text-xs uppercase tracking-widest px-1">Daily Habits</h3>
                    <DailyGrid />
                    
                    <h3 className="font-bold text-slate-400 text-xs uppercase tracking-widest px-1">Tasks</h3>
                    <div className="space-y-3">
                        {tasks.filter(t => !t.complete).slice(0, 3).map(t => (
                            <Card key={t.id} onClick={() => completeTask(t.id)} className="flex items-center justify-between group hover:border-indigo-300">
                                <div className="flex items-center gap-3">
                                    <div className={`w-5 h-5 rounded-full border-2 ${t.energy === 'high' ? 'border-red-400' : 'border-slate-300'}`} />
                                    <div>
                                        <div className="font-bold dark:text-white">{t.title}</div>
                                        <div className="text-[10px] text-slate-400 font-bold uppercase">{t.energy} Energy ‚Ä¢ {t.time} mins</div>
                                    </div>
                                </div>
                            </Card>
                        ))}
                         <button onClick={() => { setQuickAddType('task'); setIsQuickAddOpen(true); }} className="w-full py-3 border-2 border-dashed border-slate-200 dark:border-slate-800 rounded-2xl text-slate-400 text-sm font-bold hover:text-indigo-500 hover:border-indigo-300 transition">+ Add Task</button>
                    </div>
                </div>
            );

            const ProgressView = () => (
                <div className="space-y-6 pb-24">
                    <h2 className="text-2xl font-bold dark:text-white">Physique & Goals</h2>
                    
                    {/* Weight Card */}
                    <Card className="bg-slate-900 text-white relative overflow-hidden">
                        <div className="relative z-10 flex justify-between items-end">
                            <div>
                                <div className="text-slate-400 text-xs font-bold uppercase mb-1">Current Weight</div>
                                <div className="text-4xl font-black">{user.weight} <span className="text-lg font-medium text-slate-400">lbs</span></div>
                            </div>
                            <div className="text-right">
                                <div className="text-indigo-400 text-xs font-bold uppercase mb-1">Goal</div>
                                <div className="text-2xl font-bold">{user.goalWeight} <span className="text-sm font-medium text-slate-400">lbs</span></div>
                            </div>
                        </div>
                        <div className="mt-4 h-2 bg-white/10 rounded-full overflow-hidden">
                            {/* Simple calculation for bar width assuming start ~175, goal 162 */}
                            <div className="h-full bg-indigo-500" style={{ width: `${Math.max(0, Math.min(100, (175 - user.weight) / (175 - user.goalWeight) * 100))}%` }}></div>
                        </div>
                        <div className="mt-2 text-xs text-slate-400 text-center">{user.weight - user.goalWeight} lbs to go! Lean out mode.</div>
                    </Card>

                    <h3 className="font-bold text-slate-400 text-xs uppercase tracking-widest px-1 mt-8">Recent History</h3>
                     <div className="space-y-2">
                         {[1,2,3].map(i => (
                             <div key={i} className="flex justify-between items-center p-4 bg-white dark:bg-slate-900 rounded-2xl border border-slate-100 dark:border-slate-800 opacity-60">
                                 <span className="text-sm font-bold dark:text-white">Day {i} ago</span>
                                 <span className="text-xs font-bold text-green-500">Hit Goals</span>
                             </div>
                         ))}
                     </div>
                </div>
            );

            // -- Modals & Forms --
            const handleQuickAdd = (e) => {
                e.preventDefault();
                const form = e.target;
                if (quickAddType === 'task') {
                    setTasks([...tasks, { id: Date.now(), title: form.title.value, energy: 'medium', time: 15, complete: false, category: 'personal' }]);
                    showToast("Task Added");
                } else if (quickAddType === 'weight') {
                    setUser(prev => ({...prev, weight: parseFloat(form.weight.value)}));
                    showToast("Weight Updated", "info");
                } else if (quickAddType === 'grocery') {
                    setGroceries([...groceries, {id: Date.now(), name: form.item.value, category: 'Other', checked: false}]);
                    showToast("Added to List");
                }
                setIsQuickAddOpen(false);
            };

            return (
                <div className={`min-h-screen ${darkMode ? 'dark bg-slate-950' : 'bg-slate-50'}`}>
                    
                    {/* Header */}
                    <div className="fixed top-0 left-0 right-0 h-16 bg-white/90 dark:bg-slate-900/90 backdrop-blur z-40 flex items-center justify-between px-6 border-b border-slate-100 dark:border-slate-800">
                        <div className="font-black text-xl tracking-tight text-slate-900 dark:text-white">Jasmine<span className="text-indigo-600">OS</span></div>
                        <button onClick={() => setDarkMode(!darkMode)} className="p-2 bg-slate-100 dark:bg-slate-800 rounded-full"><Icons.Settings size={18} /></button>
                    </div>

                    {/* Main Content */}
                    <div className="pt-20 px-6 max-w-md mx-auto">
                        {activeTab === 'dashboard' && <Dashboard />}
                        {activeTab === 'progress' && <ProgressView />}
                        {activeTab === 'kitchen' && (
                            <div className="pb-24">
                                <h2 className="text-2xl font-bold mb-4 dark:text-white">Kitchen & Needs</h2>
                                <Card className="bg-green-50 dark:bg-green-900/20 border-green-100 dark:border-green-900 mb-6">
                                    <div className="font-bold text-green-800 dark:text-green-300 text-sm mb-1">Dietary Focus</div>
                                    <div className="text-xs text-green-700 dark:text-green-400">Remember: Low cholesterol. Focus on oats, beans, nuts, and fatty fish. Avoid processed snacks.</div>
                                </Card>
                                <div className="space-y-3">
                                    {groceries.map(g => (
                                        <Card key={g.id} onClick={() => setGroceries(gs => gs.map(x => x.id === g.id ? {...x, checked: !x.checked} : x))} className="flex justify-between items-center py-4">
                                            <span className={g.checked ? 'line-through text-slate-400' : 'font-medium dark:text-white'}>{g.name}</span>
                                            <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${g.checked ? 'bg-green-500 border-green-500' : 'border-slate-200'}`}>{g.checked && <Icons.Check size={14} className="text-white" />}</div>
                                        </Card>
                                    ))}
                                    <button onClick={() => { setQuickAddType('grocery'); setIsQuickAddOpen(true); }} className="w-full py-3 text-slate-400 font-bold text-sm uppercase">+ Add Item</button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Bottom Nav */}
                    <div className="fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-900 border-t border-slate-100 dark:border-slate-800 pb-safe pt-2 px-6 flex justify-between items-center z-50 h-20">
                        <button onClick={() => setActiveTab('dashboard')} className={`flex flex-col items-center gap-1 ${activeTab === 'dashboard' ? 'text-indigo-600' : 'text-slate-400'}`}><Icons.Activity /><span className="text-[10px] font-bold uppercase">Today</span></button>
                        <button onClick={() => { setQuickAddType('task'); setIsQuickAddOpen(true); }} className="bg-indigo-600 text-white p-4 rounded-full shadow-lg shadow-indigo-500/30 -mt-8 border-4 border-slate-50 dark:border-slate-950"><Icons.Plus /></button>
                        <button onClick={() => setActiveTab('kitchen')} className={`flex flex-col items-center gap-1 ${activeTab === 'kitchen' ? 'text-indigo-600' : 'text-slate-400'}`}><Icons.ShoppingBag /><span className="text-[10px] font-bold uppercase">Food</span></button>
                        <button onClick={() => setActiveTab('progress')} className={`flex flex-col items-center gap-1 ${activeTab === 'progress' ? 'text-indigo-600' : 'text-slate-400'}`}><Icons.TrendingUp /><span className="text-[10px] font-bold uppercase">Stats</span></button>
                    </div>

                    {/* Quick Add Modal */}
                    <Modal isOpen={isQuickAddOpen} onClose={() => setIsQuickAddOpen(false)} title="Quick Add">
                        <div className="flex gap-2 mb-4 overflow-x-auto pb-2">
                            {['task', 'weight', 'grocery'].map(t => (
                                <button key={t} onClick={() => setQuickAddType(t)} className={`px-4 py-2 rounded-full text-xs font-bold uppercase transition ${quickAddType === t ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-500 dark:bg-slate-800'}`}>{t}</button>
                            ))}
                        </div>
                        <form onSubmit={handleQuickAdd} className="space-y-4">
                            {quickAddType === 'task' && <input name="title" placeholder="What needs doing?" className="w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-800 dark:text-white outline-none" autoFocus />}
                            {quickAddType === 'weight' && <input name="weight" type="number" step="0.1" placeholder="Current weight (lbs)" className="w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-800 dark:text-white outline-none" autoFocus />}
                            {quickAddType === 'grocery' && <input name="item" placeholder="Item name" className="w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-800 dark:text-white outline-none" autoFocus />}
                            <button className="w-full py-4 bg-indigo-600 text-white font-bold rounded-xl shadow-lg">Save</button>
                        </form>
                    </Modal>

                    {/* Meal Popover */}
                    {mealPopoverOpen && (
                         <div className="fixed inset-0 bg-black/40 z-[60] flex items-end justify-center p-4" onClick={() => setMealPopoverOpen(false)}>
                            <div className="bg-white dark:bg-slate-900 w-full max-w-sm rounded-3xl p-6 animate-toast space-y-3" onClick={e => e.stopPropagation()}>
                                <h3 className="font-bold text-center dark:text-white mb-4">Log Meal</h3>
                                <div className="p-3 bg-yellow-50 text-yellow-800 text-xs font-bold rounded-xl text-center mb-4 border border-yellow-100">
                                    ‚ö†Ô∏è Watch Cholesterol: Avoid saturated fats.
                                </div>
                                <button onClick={() => logMeal('Breakfast', true)} className="w-full p-4 bg-green-50 text-green-700 font-bold rounded-xl border border-green-100">Healthy Breakfast (Oats/Fruit)</button>
                                <button onClick={() => logMeal('Lunch')} className="w-full p-4 bg-slate-50 text-slate-700 font-bold rounded-xl">Lunch</button>
                                <button onClick={() => logMeal('Dinner')} className="w-full p-4 bg-slate-50 text-slate-700 font-bold rounded-xl">Dinner</button>
                                <button onClick={() => logMeal('Snack')} className="w-full p-4 bg-slate-50 text-slate-700 font-bold rounded-xl">Snack</button>
                            </div>
                        </div>
                    )}

                    {/* Reading Popover */}
                     {readPopoverOpen && (
                         <div className="fixed inset-0 bg-black/40 z-[60] flex items-end justify-center p-4" onClick={() => setReadPopoverOpen(false)}>
                            <div className="bg-white dark:bg-slate-900 w-full max-w-sm rounded-3xl p-6 animate-toast space-y-3" onClick={e => e.stopPropagation()}>
                                <h3 className="font-bold text-center dark:text-white mb-2">Reading Log</h3>
                                <div className="text-center text-xs text-slate-400 mb-4">{user.currentBook}</div>
                                <div className="flex gap-3">
                                    <button onClick={() => { setMindfulness(p => ({...p, readPages: p.readPages + 5})); showToast("+5 Pages"); }} className="flex-1 p-4 bg-slate-50 font-bold rounded-xl text-slate-600 hover:bg-indigo-50 hover:text-indigo-600">+5</button>
                                    <button onClick={() => { setMindfulness(p => ({...p, readPages: p.readPages + 10})); showToast("+10 Pages"); }} className="flex-1 p-4 bg-slate-50 font-bold rounded-xl text-slate-600 hover:bg-indigo-50 hover:text-indigo-600">+10</button>
                                    <button onClick={() => { setMindfulness(p => ({...p, readPages: p.readPages + 20})); showToast("+20 Pages", "success", 10); triggerConfetti(); setReadPopoverOpen(false); }} className="flex-1 p-4 bg-indigo-600 text-white font-bold rounded-xl shadow-lg shadow-indigo-200">+20</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Toasts */}
                    <div className="fixed bottom-24 left-0 right-0 pointer-events-none flex flex-col items-center gap-2 z-[70]">
                        {toasts.map(t => (
                            <div key={t.id} className="bg-slate-900 text-white px-6 py-3 rounded-full shadow-2xl animate-toast font-bold flex items-center gap-2">
                                {t.message} {t.points > 0 && <span className="text-green-400 text-xs">+{t.points} pts</span>}
                            </div>
                        ))}
                    </div>

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
